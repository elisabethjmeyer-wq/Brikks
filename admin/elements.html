<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Brikks - Banque d'√©l√©ments">
    <title>Banque d'√©l√©ments - Administration - Brikks</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/admin-elements.css">
</head>
<body>

<div id="elements-page">
    <!-- Page Header -->
    <header class="admin-header">
        <div>
            <h1>Banque d'√©l√©ments</h1>
            <p>G√©rez les √©l√©ments utilis√©s dans vos exercices</p>
        </div>
        <div class="header-actions">
            <button class="btn btn-primary" id="addElementBtn">
                <span>+</span>
                Nouvel √©l√©ment
            </button>
        </div>
    </header>

    <!-- Loader -->
    <div class="loader-container" id="loader">
        <div class="loader"></div>
        <p>Chargement des √©l√©ments...</p>
    </div>

    <!-- Contenu principal -->
    <div id="elements-content" style="display: none;">
        <!-- Stats Cards - 5 types -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon blue">üìù</div>
                <div class="stat-content">
                    <div class="stat-value" id="statQCM">0</div>
                    <div class="stat-label">Questions QCM</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon orange">üìÖ</div>
                <div class="stat-content">
                    <div class="stat-value" id="statEvenement">0</div>
                    <div class="stat-label">√âv√©nements</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon green">üîó</div>
                <div class="stat-content">
                    <div class="stat-value" id="statPaire">0</div>
                    <div class="stat-label">Paires</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon teal">üìç</div>
                <div class="stat-content">
                    <div class="stat-value" id="statPointCarte">0</div>
                    <div class="stat-label">Points carte</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon pink">üìÇ</div>
                <div class="stat-content">
                    <div class="stat-value" id="statItemCategorie">0</div>
                    <div class="stat-label">Items cat√©gorie</div>
                </div>
            </div>
        </div>

        <!-- Layout 2 colonnes -->
        <div class="elements-layout">
            <!-- Colonne gauche: Arborescence -->
            <div class="sidebar-panel">
                <div class="panel-header">
                    <h3>üìÅ Chapitres</h3>
                </div>
                <div class="panel-search">
                    <input type="text" id="searchChapter" placeholder="Rechercher un chapitre...">
                </div>
                <div class="chapters-tree" id="chaptersTree">
                    <!-- Arborescence generee dynamiquement -->
                </div>
            </div>

            <!-- Colonne droite: Liste des elements -->
            <div class="main-panel">
                <!-- Header du chapitre selectionne -->
                <div class="elements-header" id="elementsHeader">
                    <div class="elements-header-left">
                        <div class="elements-header-icon" id="headerIcon">üìã</div>
                        <div class="elements-header-info">
                            <h2 id="selectedChapterName">Tous les chapitres</h2>
                            <p id="selectedChapterMeta">0 √©l√©ments</p>
                        </div>
                    </div>
                    <button class="btn btn-primary btn-sm" id="addElementBtnHeader">
                        <span>+</span> Ajouter
                    </button>
                </div>

                <!-- Filtres par type (pills) -->
                <div class="type-filters" id="typeFilters">
                    <button class="type-filter active" data-type="all">
                        <span class="type-filter-icon">üìã</span>
                        Tous
                        <span class="type-filter-count" id="countAll">0</span>
                    </button>
                    <button class="type-filter" data-type="qcm">
                        <span class="type-filter-icon">üìù</span>
                        QCM
                        <span class="type-filter-count" id="countQCM">0</span>
                    </button>
                    <button class="type-filter" data-type="evenement">
                        <span class="type-filter-icon">üìÖ</span>
                        √âv√©nements
                        <span class="type-filter-count" id="countEvenement">0</span>
                    </button>
                    <button class="type-filter" data-type="paire">
                        <span class="type-filter-icon">üîó</span>
                        Paires
                        <span class="type-filter-count" id="countPaire">0</span>
                    </button>
                    <button class="type-filter" data-type="point_carte">
                        <span class="type-filter-icon">üìç</span>
                        Points carte
                        <span class="type-filter-count" id="countPointCarte">0</span>
                    </button>
                    <button class="type-filter" data-type="item_categorie">
                        <span class="type-filter-icon">üìÇ</span>
                        Items
                        <span class="type-filter-count" id="countItemCategorie">0</span>
                    </button>
                    <button class="type-filter" data-type="reponse_libre">
                        <span class="type-filter-icon">üí¨</span>
                        Rep. libres
                        <span class="type-filter-count" id="countRepLibre">0</span>
                    </button>
                </div>

                <!-- Recherche -->
                <div class="search-bar">
                    <input type="text" id="searchInput" placeholder="Rechercher dans les √©l√©ments...">
                </div>

                <!-- Liste des elements -->
                <div class="elements-list" id="elementsList">
                    <!-- Elements generes dynamiquement -->
                </div>

                <!-- Empty state -->
                <div class="empty-state" id="emptyState" style="display: none;">
                    <div class="empty-icon">üì≠</div>
                    <h3>Aucun √©l√©ment trouv√©</h3>
                    <p>Modifiez vos filtres ou ajoutez un nouvel √©l√©ment.</p>
                    <button class="btn btn-primary" id="addElementBtnEmpty">+ Ajouter un √©l√©ment</button>
                </div>

                <!-- Pagination -->
                <div class="pagination-bar" id="paginationBar">
                    <div class="pagination-info" id="paginationInfo">0 √©l√©ments</div>
                    <div class="pagination" id="pagination"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Ajouter/Modifier element -->
<div class="modal-overlay hidden" id="elementModal">
    <div class="modal modal-large">
        <div class="modal-header">
            <h2 id="elementModalTitle">‚ûï Nouvel √©l√©ment</h2>
            <button class="modal-close" id="closeElementModal">&times;</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="editElementId">

            <!-- Selection du type -->
            <div class="form-section">Type d'√©l√©ment</div>
            <div class="type-selector" id="typeSelector">
                <button class="type-selector-btn active" data-type="qcm">
                    <div class="type-selector-icon">üìù</div>
                    <div class="type-selector-label">QCM</div>
                    <div class="type-selector-desc">Question √† choix</div>
                </button>
                <button class="type-selector-btn" data-type="evenement">
                    <div class="type-selector-icon">üìÖ</div>
                    <div class="type-selector-label">√âv√©nement</div>
                    <div class="type-selector-desc">Date + description</div>
                </button>
                <button class="type-selector-btn" data-type="paire">
                    <div class="type-selector-icon">üîó</div>
                    <div class="type-selector-label">Paire</div>
                    <div class="type-selector-desc">Terme ‚Üî Terme</div>
                </button>
                <button class="type-selector-btn" data-type="point_carte">
                    <div class="type-selector-icon">üìç</div>
                    <div class="type-selector-label">Point carte</div>
                    <div class="type-selector-desc">Localisation</div>
                </button>
                <button class="type-selector-btn" data-type="item_categorie">
                    <div class="type-selector-icon">üìÇ</div>
                    <div class="type-selector-label">Item cat√©gorie</div>
                    <div class="type-selector-desc">√âl√©ment + cat√©gorie</div>
                </button>
                <button class="type-selector-btn" data-type="reponse_libre">
                    <div class="type-selector-icon">üí¨</div>
                    <div class="type-selector-label">R√©ponse libre</div>
                    <div class="type-selector-desc">Question ouverte</div>
                </button>
            </div>

            <!-- Chapitre -->
            <div class="form-section">Localisation</div>
            <div class="form-row">
                <div class="form-group">
                    <label>Discipline</label>
                    <select class="form-select" id="elementDiscipline">
                        <option value="">S√©lectionner...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Chapitre <span class="req">*</span></label>
                    <select class="form-select" id="elementChapitre" disabled>
                        <option value="">S√©lectionner d'abord une discipline...</option>
                    </select>
                </div>
            </div>

            <!-- Formulaires dynamiques selon le type -->
            <div id="dynamicForm">
                <!-- QCM -->
                <div class="form-dynamic active" id="form-qcm">
                    <div class="form-section">Question QCM</div>
                    <div class="form-group">
                        <label>√ânonc√© de la question <span class="req">*</span></label>
                        <textarea class="form-textarea" id="qcmEnonce" rows="3" placeholder="Ex: Quelle est la date du passage du cap de Bonne-Esp√©rance ?"></textarea>
                    </div>
                    <div class="form-group">
                        <label>R√©ponses <span class="form-hint">(cliquez pour marquer la bonne r√©ponse)</span></label>
                        <div class="reponses-list" id="qcmReponses">
                            <div class="reponse-item correct">
                                <div class="reponse-radio">‚úì</div>
                                <input type="text" class="form-input reponse-input" placeholder="Bonne r√©ponse">
                                <button type="button" class="reponse-delete">&times;</button>
                            </div>
                            <div class="reponse-item">
                                <div class="reponse-radio"></div>
                                <input type="text" class="form-input reponse-input" placeholder="Mauvaise r√©ponse">
                                <button type="button" class="reponse-delete">&times;</button>
                            </div>
                            <div class="reponse-item">
                                <div class="reponse-radio"></div>
                                <input type="text" class="form-input reponse-input" placeholder="Mauvaise r√©ponse">
                                <button type="button" class="reponse-delete">&times;</button>
                            </div>
                            <div class="reponse-item">
                                <div class="reponse-radio"></div>
                                <input type="text" class="form-input reponse-input" placeholder="Mauvaise r√©ponse">
                                <button type="button" class="reponse-delete">&times;</button>
                            </div>
                        </div>
                        <button type="button" class="btn-add-option" id="addQcmOption">‚ûï Ajouter une r√©ponse</button>
                    </div>
                </div>

                <!-- Evenement -->
                <div class="form-dynamic" id="form-evenement">
                    <div class="form-section">√âv√©nement</div>
                    <div class="form-group">
                        <label>Description de l'√©v√©nement <span class="req">*</span></label>
                        <textarea class="form-textarea" id="eventDescription" rows="2" placeholder="Ex: Bartolomeu Dias atteint le cap de Bonne-Esp√©rance"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Date <span class="req">*</span></label>
                            <input type="text" class="form-input" id="eventDate" placeholder="Ex: 1488">
                        </div>
                        <div class="form-group">
                            <label>P√©riode <span class="form-hint">(optionnel)</span></label>
                            <input type="text" class="form-input" id="eventPeriode" placeholder="Ex: XVe si√®cle">
                        </div>
                    </div>
                </div>

                <!-- Paire -->
                <div class="form-dynamic" id="form-paire">
                    <div class="form-section">Paire (Association)</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Terme A <span class="req">*</span></label>
                            <input type="text" class="form-input" id="paireTermeA" placeholder="Ex: Bartolomeu Dias">
                        </div>
                        <div class="form-group">
                            <label>Terme B <span class="req">*</span></label>
                            <input type="text" class="form-input" id="paireTermeB" placeholder="Ex: Cap de Bonne-Esp√©rance">
                        </div>
                    </div>
                </div>

                <!-- Point carte -->
                <div class="form-dynamic" id="form-point_carte">
                    <div class="form-section">Point carte</div>
                    <div class="form-group">
                        <label>Nom du lieu <span class="req">*</span></label>
                        <input type="text" class="form-input" id="pointNom" placeholder="Ex: Lisbonne, Goa, Cap de Bonne-Esp√©rance...">
                    </div>
                    <div class="form-group">
                        <label>Carte <span class="req">*</span></label>
                        <select class="form-select" id="pointCarteSelect" onchange="AdminElements.onCarteChange(this.value)">
                            <option value="">S√©lectionner une carte...</option>
                        </select>
                    </div>
                    <!-- Carte preview avec clic pour placer le point -->
                    <div class="carte-preview-container" id="cartePreviewContainer" style="display: none;">
                        <div class="carte-preview-wrapper" onclick="AdminElements.onCarteClick(event)">
                            <img id="cartePreview" src="" alt="Aper√ßu de la carte" class="carte-preview-img">
                            <div id="carteMarker" class="carte-marker" style="display: none;">üìç</div>
                        </div>
                        <div class="carte-coords" id="carteCoords">Cliquez sur la carte pour placer le point</div>
                    </div>
                    <!-- Hidden inputs for coordinates -->
                    <input type="hidden" id="pointX">
                    <input type="hidden" id="pointY">
                </div>

                <!-- Item categorie -->
                <div class="form-dynamic" id="form-item_categorie">
                    <div class="form-section">Item de cat√©gorisation</div>
                    <div class="form-group">
                        <label>√âl√©ment √† classer <span class="req">*</span></label>
                        <input type="text" class="form-input" id="itemElement" placeholder="Ex: La caravelle">
                    </div>
                    <div class="form-group">
                        <label>Cat√©gorie correcte <span class="req">*</span></label>
                        <input type="text" class="form-input" id="itemCategorie" placeholder="Ex: Instruments de navigation">
                    </div>
                </div>

                <!-- Reponse libre -->
                <div class="form-dynamic" id="form-reponse_libre">
                    <div class="form-section">Question √† r√©ponse libre</div>
                    <div class="form-group">
                        <label>Question <span class="req">*</span></label>
                        <textarea class="form-textarea" id="libreQuestion" rows="3" placeholder="Ex: Expliquez les motivations des explorations portugaises."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Mots-cl√©s attendus <span class="form-hint">(s√©par√©s par virgules)</span></label>
                        <input type="text" class="form-input" id="libreMotsCles" placeholder="Ex: √©pices, or, route des Indes, commerce">
                    </div>
                    <div class="form-group">
                        <label>R√©ponse mod√®le <span class="form-hint">(optionnel)</span></label>
                        <textarea class="form-textarea" id="libreReponseModele" rows="3" placeholder="R√©ponse compl√®te affich√©e dans le corrig√©..."></textarea>
                    </div>
                </div>
            </div>

            <!-- Champs communs -->
            <div class="form-section">Informations compl√©mentaires</div>
            <div class="form-row">
                <div class="form-group">
                    <label>Tags <span class="form-hint">(s√©par√©s par virgules)</span></label>
                    <input type="text" class="form-input" id="elementTags" placeholder="Ex: revolution, dates, roi">
                </div>
                <div class="form-group">
                    <label>Difficult√©</label>
                    <select class="form-select" id="elementDifficulte">
                        <option value="facile">Facile</option>
                        <option value="moyen">Moyen</option>
                        <option value="difficile">Difficile</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>Explication <span class="form-hint">(affich√©e apr√®s correction)</span></label>
                <textarea class="form-textarea" id="elementExplication" rows="2" placeholder="Explication affich√©e apr√®s la correction..."></textarea>
            </div>

        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" id="cancelElementBtn">Annuler</button>
            <button class="btn btn-primary" id="saveElementBtn">üíæ Enregistrer</button>
        </div>
    </div>
</div>

<!-- Modal: Confirmation suppression -->
<div class="modal-overlay hidden" id="deleteModal">
    <div class="modal modal-small">
        <div class="modal-header">
            <h2>Confirmer la suppression</h2>
            <button class="modal-close" id="closeDeleteModal">&times;</button>
        </div>
        <div class="modal-body">
            <p>Etes-vous sur de vouloir supprimer cet element ?</p>
            <p class="delete-warning">Cette action est irreversible.</p>
            <input type="hidden" id="deleteElementId">
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" id="cancelDeleteBtn">Annuler</button>
            <button class="btn btn-danger" id="confirmDeleteBtn">Supprimer</button>
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="../js/config.js"></script>
<script src="../js/sheets.js"></script>
<script src="../js/auth.js"></script>
<script src="../js/app.js"></script>
<script src="../components/admin-layout.js"></script>
<script src="../js/admin-elements.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        AdminLayout.init('elements', 'Banque d\'elements');
    });
</script>

</body>
</html>
