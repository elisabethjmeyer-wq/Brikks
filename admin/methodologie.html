<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Brikks - Gestion de la m√©thodologie">
    <title>M√©thodologie - Administration - Brikks</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/admin-methodologie.css">
</head>
<body>

<div id="methodologie-page">
    <!-- Page Header -->
    <header class="page-header">
        <div class="page-header-left">
            <h1>üß† M√©thodologie</h1>
            <p class="page-subtitle">Structure arborescente flexible</p>
        </div>
        <div class="page-header-actions">
            <button class="btn btn-primary" id="addCategoryBtn">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"/>
                    <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
                Nouvel √©l√©ment
            </button>
        </div>
    </header>

    <!-- Loader -->
    <div class="loader-container" id="loader">
        <div class="loader"></div>
        <p>Chargement...</p>
    </div>

    <!-- Main Content -->
    <div id="methodologie-content" style="display: none;">
        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon-wrapper blue">üìÅ</div>
                <div class="stat-value" id="totalCategories">0</div>
                <div class="stat-label">Racines</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon-wrapper purple">üìã</div>
                <div class="stat-value" id="totalCompetences">0</div>
                <div class="stat-label">Total √©l√©ments</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon-wrapper teal">üé¨</div>
                <div class="stat-value" id="totalEtapes">0</div>
                <div class="stat-label">Contenus vid√©o</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon-wrapper green">üéØ</div>
                <div class="stat-value" id="totalNiveaux">0</div>
                <div class="stat-label">Profondeur max</div>
            </div>
        </div>

        <!-- Tree Container -->
        <div class="tree-container" id="categories-container">
            <!-- Filled dynamically -->
        </div>
    </div>
</div>

<!-- MODAL: √âl√©ment -->
<div class="modal-overlay hidden" id="itemModal">
    <div class="modal modal-large">
        <div class="modal-header">
            <h2 id="itemModalTitle">Nouvel √©l√©ment</h2>
            <button class="modal-close" id="closeItemModal">&times;</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="itemId">
            <input type="hidden" id="itemParentId">

            <div id="parentInfo" class="parent-info" style="display: none;"></div>

            <div class="form-group">
                <label>Titre <span class="required">*</span></label>
                <input type="text" class="form-input" id="itemTitre" placeholder="Ex: Analyser un document">
            </div>

            <div class="form-group">
                <label>Description</label>
                <input type="text" class="form-input" id="itemDescription" placeholder="Br√®ve description de l'√©l√©ment">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Ic√¥ne</label>
                    <div class="icon-selector" id="itemIconSelector">
                        <!-- Filled dynamically -->
                    </div>
                </div>

                <div class="form-group">
                    <label>Couleur</label>
                    <div class="color-selector" id="itemColorSelector">
                        <!-- Filled dynamically -->
                    </div>
                </div>
            </div>

            <hr class="form-divider">
            <p class="form-section-title">üìπ Contenu (optionnel - laissez vide pour un dossier)</p>

            <div class="form-group">
                <label>URL de la vid√©o</label>
                <input type="url" class="form-input" id="itemVideoUrl" placeholder="https://www.loom.com/share/... ou https://youtube.com/...">
                <p class="form-hint">Loom, YouTube ou Vimeo - Si rempli, cet √©l√©ment sera un contenu</p>
            </div>

            <div class="form-group">
                <label>Documents (JSON)</label>
                <textarea class="form-textarea" id="itemDocuments" rows="2" placeholder='[{"titre":"Fiche.pdf","url":"https://...","taille":"2MB"}]'></textarea>
            </div>

            <div class="form-group">
                <label>Contenu HTML</label>
                <textarea class="form-textarea" id="itemContenu" rows="3" placeholder="<p>Contenu affich√© sous la vid√©o...</p>"></textarea>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>ID BEX (exercice)</label>
                    <input type="text" class="form-input" id="itemBexId" placeholder="bex1">
                </div>

                <div class="form-group">
                    <label>Titre BEX</label>
                    <input type="text" class="form-input" id="itemBexTitre" placeholder="Exercice pratique">
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" id="cancelItemBtn">Annuler</button>
            <button class="btn btn-primary" id="saveItemBtn">Enregistrer</button>
        </div>
    </div>
</div>

<!-- MODAL: Confirmer suppression -->
<div class="modal-overlay hidden" id="deleteModal">
    <div class="modal modal-confirm">
        <div class="modal-body">
            <div class="confirm-icon">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"/>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                </svg>
            </div>
            <h3 class="confirm-title" id="deleteTitle">Supprimer ?</h3>
            <p class="confirm-text" id="deleteText">Cette action est irr√©versible.</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" id="cancelDeleteBtn">Annuler</button>
            <button class="btn btn-danger" id="confirmDeleteBtn">Supprimer</button>
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="../js/config.js"></script>
<script src="../js/sheets.js"></script>
<script src="../js/auth.js"></script>
<script src="../js/app.js"></script>
<script src="../components/admin-layout.js"></script>
<script src="../js/admin-methodologie.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        AdminLayout.init('methodologie', 'M√©thodologie');
        AdminMethodologie.init();
    });
</script>

</body>
</html>
