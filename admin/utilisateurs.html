<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Brikks - Gestion des utilisateurs">
    <title>Gestion des utilisateurs - Administration - Brikks</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/admin-utilisateurs.css">
</head>
<body>

<!-- Contenu de la page -->
<div id="utilisateurs-page">
    <!-- Page Header -->
    <header class="admin-header">
        <div>
            <h1>ğŸ‘¥ Gestion des utilisateurs</h1>
            <p>GÃ©rez les Ã©lÃ¨ves, classes et groupes de la plateforme</p>
        </div>
        <div class="header-actions">
            <button class="btn btn-secondary" id="manageBtn">
                <span>âš™ï¸</span>
                GÃ©rer classes/groupes
            </button>
            <button class="btn btn-primary" id="addUserBtn">
                <span>â•</span>
                Ajouter un utilisateur
            </button>
        </div>
    </header>

    <!-- Loader -->
    <div class="loader-container" id="loader">
        <div class="loader"></div>
        <p>Chargement des utilisateurs...</p>
    </div>

    <!-- Contenu principal (masquÃ© pendant le chargement) -->
    <div id="users-content" style="display: none;">

        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-card-icon blue">ğŸ‘¥</div>
                <div class="stat-card-value" id="statTotal">0</div>
                <div class="stat-card-label">Utilisateurs total</div>
            </div>
            <div class="stat-card">
                <div class="stat-card-icon green">ğŸ“</div>
                <div class="stat-card-value" id="statEleves">0</div>
                <div class="stat-card-label">Ã‰lÃ¨ves</div>
            </div>
            <div class="stat-card">
                <div class="stat-card-icon purple">ğŸ‘©â€ğŸ«</div>
                <div class="stat-card-value" id="statProfs">0</div>
                <div class="stat-card-label">Professeurs</div>
            </div>
            <div class="stat-card">
                <div class="stat-card-icon teal">ğŸ‘‹</div>
                <div class="stat-card-value" id="statInvites">0</div>
                <div class="stat-card-label">InvitÃ©s</div>
            </div>
        </div>

        <!-- Filtres -->
        <div class="filters-bar">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Rechercher un utilisateur...">
            </div>
            <select class="filter-select" id="filterClasse">
                <option value="">Toutes les classes</option>
            </select>
            <select class="filter-select" id="filterGroupe">
                <option value="">Tous les groupes</option>
            </select>
            <select class="filter-select" id="filterRole">
                <option value="">Tous les rÃ´les</option>
                <option value="eleve">Ã‰lÃ¨ve</option>
                <option value="prof">Professeur</option>
                <option value="invite">InvitÃ©</option>
            </select>
        </div>

        <!-- Tableau des utilisateurs -->
        <div class="table-card">
            <div class="table-header">
                <h2>Liste des utilisateurs</h2>
                <span class="table-count" id="tableCount">0 utilisateurs</span>
            </div>

            <table class="users-table">
                <thead>
                    <tr>
                        <th>Utilisateur</th>
                        <th>RÃ´le</th>
                        <th>Classe</th>
                        <th>Groupe</th>
                        <th>DerniÃ¨re connexion</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="usersTableBody">
                    <!-- Lignes gÃ©nÃ©rÃ©es dynamiquement -->
                </tbody>
            </table>

            <!-- Empty state -->
            <div class="empty-state" id="emptyState" style="display: none;">
                <div class="empty-icon">ğŸ‘¥</div>
                <h3>Aucun utilisateur trouvÃ©</h3>
                <p>Modifiez vos filtres ou ajoutez un nouvel utilisateur.</p>
            </div>

            <!-- Pagination -->
            <div class="table-footer" id="tableFooter">
                <div class="pagination-info" id="paginationInfo">Affichage 1-10 sur 0 utilisateurs</div>
                <div class="pagination" id="pagination">
                    <!-- Pagination gÃ©nÃ©rÃ©e dynamiquement -->
                </div>
            </div>
        </div>

    </div>
</div>

<!-- ===== MODAL: Ajouter/Modifier utilisateur ===== -->
<div class="modal-overlay hidden" id="userModal">
    <div class="modal">
        <div class="modal-header">
            <h2 id="userModalTitle">Ajouter un utilisateur</h2>
            <button class="modal-close" id="closeUserModal">âœ•</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="editUserId">

            <div class="form-section">ğŸ‘¤ Informations personnelles</div>

            <div class="form-row">
                <div class="form-group">
                    <label>PrÃ©nom <span class="req">*</span></label>
                    <input type="text" class="form-input" id="userPrenom" placeholder="Ex: Ilyana">
                </div>
                <div class="form-group">
                    <label>Nom <span class="req">*</span></label>
                    <input type="text" class="form-input" id="userNom" placeholder="Ex: Amrani">
                </div>
            </div>

            <div class="form-group">
                <label>RÃ´le <span class="req">*</span></label>
                <select class="form-select" id="userRole">
                    <option value="eleve">ğŸ“ Ã‰lÃ¨ve</option>
                    <option value="prof">ğŸ‘©â€ğŸ« Professeur</option>
                    <option value="invite">ğŸ‘‹ InvitÃ©</option>
                </select>
            </div>

            <div id="classeGroupeFields">
                <div class="form-row">
                    <div class="form-group">
                        <label>Classe <span class="req">*</span></label>
                        <select class="form-select" id="userClasse">
                            <option value="">SÃ©lectionner...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Groupe</label>
                        <select class="form-select" id="userGroupe">
                            <option value="">Aucun</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="form-section" style="margin-top: 24px;">ğŸ” Identifiants</div>

            <div class="form-group">
                <label>Identifiant <span class="req">*</span></label>
                <input type="text" class="form-input" id="userIdentifiant" placeholder="Ex: i.amrani">
                <div class="form-help">UtilisÃ© pour la connexion</div>
            </div>

            <div class="form-group">
                <label>Mot de passe <span id="passwordRequired" class="req">*</span></label>
                <div class="password-row">
                    <input type="text" class="form-input" id="userPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                    <button type="button" class="btn-generate" id="showPasswordBtn" style="display: none;">ğŸ‘ï¸ Voir</button>
                    <button type="button" class="btn-generate" id="generatePasswordBtn">GÃ©nÃ©rer</button>
                </div>
                <div class="form-help" id="passwordHelp">Minimum 6 caractÃ¨res</div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" id="cancelUserBtn">Annuler</button>
            <button class="btn btn-primary" id="saveUserBtn">ğŸ’¾ Enregistrer</button>
        </div>
    </div>
</div>

<!-- ===== MODAL: RÃ©initialiser mot de passe ===== -->
<div class="modal-overlay hidden" id="passwordModal">
    <div class="modal">
        <div class="modal-header">
            <h2>ğŸ”‘ RÃ©initialiser le mot de passe</h2>
            <button class="modal-close" id="closePasswordModal">âœ•</button>
        </div>
        <div class="modal-body">
            <p style="margin-bottom: 16px; color: var(--gray-600);">Pour <strong id="passwordUserName"></strong></p>
            <input type="hidden" id="passwordUserId">

            <div class="form-group">
                <label>Nouveau mot de passe <span class="req">*</span></label>
                <div class="password-row">
                    <input type="text" class="form-input" id="newPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                    <button type="button" class="btn-generate" id="generateNewPasswordBtn">GÃ©nÃ©rer</button>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" id="cancelPasswordBtn">Annuler</button>
            <button class="btn btn-primary" id="confirmPasswordBtn">âœ“ RÃ©initialiser</button>
        </div>
    </div>
</div>

<!-- ===== MODAL: Supprimer utilisateur ===== -->
<div class="modal-overlay hidden" id="deleteModal">
    <div class="modal confirm">
        <div class="modal-header">
            <h2></h2>
            <button class="modal-close" id="closeDeleteModal">âœ•</button>
        </div>
        <div class="modal-body">
            <div class="confirm-icon">ğŸ—‘ï¸</div>
            <div class="confirm-title">Supprimer cet utilisateur ?</div>
            <div class="confirm-text">ÃŠtes-vous sÃ»r de vouloir supprimer <strong id="deleteUserName"></strong> ? Cette action est irrÃ©versible.</div>
            <input type="hidden" id="deleteUserId">
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" id="cancelDeleteBtn">Annuler</button>
            <button class="btn btn-danger" id="confirmDeleteBtn">ğŸ—‘ï¸ Supprimer</button>
        </div>
    </div>
</div>

<!-- ===== MODAL: GÃ©rer classes et groupes ===== -->
<div class="modal-overlay hidden" id="manageModal">
    <div class="modal">
        <div class="modal-header">
            <h2>âš™ï¸ GÃ©rer classes et groupes</h2>
            <button class="modal-close" id="closeManageModal">âœ•</button>
        </div>
        <div class="modal-body">
            <!-- Classes -->
            <div class="manage-section">
                <div class="manage-section-title">ğŸ« Classes</div>
                <div class="tags-list" id="classesList">
                    <!-- GÃ©nÃ©rÃ©es dynamiquement -->
                </div>
                <div class="add-inline">
                    <input type="text" id="newClasseName" placeholder="Nom de la nouvelle classe...">
                    <button id="addClasseBtn">+ Ajouter</button>
                </div>
            </div>

            <!-- Groupes -->
            <div class="manage-section">
                <div class="manage-section-title">ğŸ‘¥ Groupes</div>
                <div class="tags-list" id="groupesList">
                    <!-- GÃ©nÃ©rÃ©es dynamiquement -->
                </div>
                <div class="add-inline">
                    <input type="text" id="newGroupeName" placeholder="Nom du nouveau groupe...">
                    <button id="addGroupeBtn">+ Ajouter</button>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" id="closeManageBtn">Fermer</button>
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="../js/config.js"></script>
<script src="../js/sheets.js"></script>
<script src="../js/app.js"></script>
<script src="../js/auth.js"></script>
<script src="../components/admin-layout.js"></script>
<script src="../js/admin-utilisateurs.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', async function() {
        await AdminLayout.init('utilisateurs', 'Gestion des utilisateurs');
        AdminUtilisateurs.init();
    });
</script>

</body>
</html>
