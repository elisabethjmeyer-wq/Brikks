<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Brikks - Gestion des entrainements">
    <title>Entrainements - Administration - Brikks</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/admin-entrainements.css">
</head>
<body>

<div id="entrainements-page">
    <!-- Page Header -->
    <header class="admin-header">
        <div>
            <h1>üìù Entra√Ænements</h1>
            <p>Cr√©ez des s√©ries d'exercices pour que vos √©l√®ves s'entra√Ænent</p>
        </div>
        <div class="header-actions">
            <button class="btn btn-primary" id="addEntrainementBtn">
                <span>‚ûï</span>
                Nouvel entra√Ænement
            </button>
        </div>
    </header>

    <!-- Loader -->
    <div class="loader-container" id="loader">
        <div class="loader"></div>
        <p>Chargement des entrainements...</p>
    </div>

    <!-- Contenu principal -->
    <div id="entrainements-content" style="display: none;">
        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-card-icon blue">üéÆ</div>
                <div class="stat-card-value" id="statTotal">0</div>
                <div class="stat-card-label">Entra√Ænements cr√©√©s</div>
            </div>
            <div class="stat-card">
                <div class="stat-card-icon green">‚úÖ</div>
                <div class="stat-card-value" id="statPublies">0</div>
                <div class="stat-card-label">Publi√©s</div>
            </div>
            <div class="stat-card">
                <div class="stat-card-icon orange">üìù</div>
                <div class="stat-card-value" id="statBrouillons">0</div>
                <div class="stat-card-label">Brouillons</div>
            </div>
            <div class="stat-card">
                <div class="stat-card-icon purple">üë•</div>
                <div class="stat-card-value" id="statParticipations">0</div>
                <div class="stat-card-label">Participations √©l√®ves</div>
            </div>
        </div>

        <!-- Type Filter Tabs -->
        <div class="type-tabs" id="filterTabs">
            <button class="type-tab active" data-type="">
                üìã Tous
                <span class="count" id="countAll">0</span>
            </button>
            <button class="type-tab connaissances" data-type="connaissances">
                ‚úÖ Connaissances
                <span class="count" id="countConnaissances">0</span>
            </button>
            <button class="type-tab savoir-faire" data-type="savoir-faire">
                üîß Savoir-faire
                <span class="count" id="countSavoirFaire">0</span>
            </button>
            <button class="type-tab competences" data-type="competences">
                üéØ Comp√©tences
                <span class="count" id="countCompetences">0</span>
            </button>
        </div>

        <!-- Filters Bar -->
        <div class="filters-bar">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Rechercher un entra√Ænement...">
            </div>
            <select class="filter-select" id="filterDiscipline">
                <option value="">üìö Toutes les mati√®res</option>
            </select>
            <select class="filter-select" id="filterStatut">
                <option value="">üìä Tous les statuts</option>
                <option value="publie">‚úÖ Publi√©s</option>
                <option value="brouillon">üìù Brouillons</option>
            </select>
        </div>

        <!-- Entrainements Grid -->
        <div class="entrainements-grid" id="entrainementsGrid">
            <!-- Generated dynamically -->
        </div>

        <!-- Empty state -->
        <div class="empty-state" id="emptyState" style="display: none;">
            <div class="empty-icon">?</div>
            <h3>Aucun entra√Ænement trouv√©</h3>
            <p>Modifiez vos filtres ou cr√©ez un nouvel entra√Ænement.</p>
        </div>
    </div>
</div>

<!-- Modal: Wizard Entrainement -->
<div class="modal-overlay hidden" id="entrainementModal">
    <div class="modal modal-wizard">
        <div class="modal-header">
            <h2 id="entrainementModalTitle">Cr√©er un entra√Ænement</h2>
            <button class="modal-close" id="closeEntrainementModal">&times;</button>
        </div>

        <!-- Wizard Steps Indicator -->
        <div class="wizard-steps">
            <div class="wizard-step active" data-step="1">
                <span class="step-number">1</span>
                <span class="step-label">Param√®tres</span>
            </div>
            <div class="wizard-step" data-step="2">
                <span class="step-number">2</span>
                <span class="step-label">Exercices</span>
            </div>
            <div class="wizard-step" data-step="3">
                <span class="step-number">3</span>
                <span class="step-label">Validation</span>
            </div>
        </div>

        <div class="modal-body">
            <input type="hidden" id="editEntrainementId">

            <!-- Step 1: Parametres -->
            <div class="wizard-content" id="step1" style="display: block;">
                <div class="form-group">
                    <label>Titre <span class="req">*</span></label>
                    <input type="text" class="form-input" id="entrainementTitre" placeholder="Ex: Quiz sur la R√©volution fran√ßaise">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Type <span class="req">*</span></label>
                        <select class="form-select" id="entrainementType">
                            <option value="connaissances">Connaissances</option>
                            <option value="savoir-faire">Savoir-faire</option>
                            <option value="competences">Comp√©tences</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Num√©ro de s√©rie</label>
                        <input type="number" class="form-input" id="entrainementOrdre" value="1" min="1">
                        <div class="form-help">Ex: S√©rie 1/3, 2/3...</div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Discipline</label>
                        <select class="form-select" id="entrainementDiscipline">
                            <option value="">S√©lectionner...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Theme</label>
                        <select class="form-select" id="entrainementTheme" disabled>
                            <option value="">S√©lectionner d'abord une discipline...</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Chapitre <span class="req">*</span></label>
                    <select class="form-select" id="entrainementChapitre" disabled>
                        <option value="">S√©lectionner d'abord un th√®me...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Description</label>
                    <textarea class="form-textarea" id="entrainementDescription" rows="2" placeholder="Description optionnelle..."></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Dur√©e estim√©e (min)</label>
                        <input type="number" class="form-input" id="entrainementDuree" value="15" min="1">
                    </div>
                    <div class="form-group">
                        <label>Statut</label>
                        <select class="form-select" id="entrainementStatut">
                            <option value="brouillon">Brouillon</option>
                            <option value="publie">Publi√©</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Step 2: Exercices (pour savoir-faire et comp√©tences) -->
            <div class="wizard-content" id="step2" style="display: none;">
                <!-- Version standard (savoir-faire, comp√©tences) -->
                <div class="exercises-layout" id="step2Standard">
                    <!-- Left: List of composed exercises -->
                    <div class="exercises-list-panel">
                        <div class="panel-header">
                            <h3>Exercices compos√©s</h3>
                            <span class="exercises-count" id="exercisesCount">0 exercices</span>
                        </div>
                        <div class="exercises-list" id="exercisesList">
                            <!-- Generated dynamically -->
                        </div>
                        <div class="exercises-empty" id="exercisesEmpty">
                            <p>Aucun exercice ajout√©</p>
                            <p class="hint">Utilisez le panneau de droite pour composer un exercice</p>
                        </div>
                    </div>

                    <!-- Right: Add exercise panel -->
                    <div class="add-exercise-panel">
                        <div class="panel-header">
                            <h3>Ajouter un exercice</h3>
                        </div>
                        <div class="add-exercise-form">
                            <div class="form-group">
                                <label>Format</label>
                                <select class="form-select" id="exerciseFormat">
                                    <option value="format_001">QCM (choix unique)</option>
                                    <option value="format_002">QCM Multiple</option>
                                    <option value="format_003">Vrai/Faux</option>
                                    <option value="format_004">Texte √† trous</option>
                                    <option value="format_005">Association</option>
                                    <option value="format_006">Ordonner</option>
                                    <option value="format_007">Question ouverte</option>
                                    <option value="format_008">Image cliquable</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Nombre d'√©l√©ments</label>
                                <input type="number" class="form-input" id="exerciseCount" value="5" min="1" max="20">
                            </div>

                            <div class="form-group">
                                <label>Mode de selection</label>
                                <div class="radio-group">
                                    <label class="radio-item">
                                        <input type="radio" name="selectionMode" value="random" checked>
                                        <span>Aleatoire</span>
                                    </label>
                                    <label class="radio-item">
                                        <input type="radio" name="selectionMode" value="manual">
                                        <span>Selection manuelle</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Elements available for this format -->
                            <div class="elements-available" id="elementsAvailable" style="display: none;">
                                <label>Elements disponibles (<span id="availableCount">0</span>)</label>
                                <div class="elements-checkboxes" id="elementsCheckboxes">
                                    <!-- Generated -->
                                </div>
                            </div>

                            <button class="btn btn-primary btn-full" id="addExerciseBtn">
                                + Ajouter l'exercice
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Version connaissances (questions de banques) -->
                <div class="exercises-layout" id="step2Connaissances" style="display: none;">
                    <!-- Left: Liste des √©tapes compos√©es -->
                    <div class="exercises-list-panel">
                        <div class="panel-header">
                            <h3>√âtapes de l'entra√Ænement</h3>
                            <span class="exercises-count" id="etapesCount">0 √©tapes</span>
                        </div>
                        <div class="exercises-list" id="etapesList">
                            <!-- Generated dynamically -->
                        </div>
                        <div class="exercises-empty" id="etapesEmpty">
                            <p>Aucune √©tape ajout√©e</p>
                            <p class="hint">S√©lectionnez une banque et ajoutez des types de questions</p>
                        </div>
                    </div>

                    <!-- Right: Ajouter une √©tape -->
                    <div class="add-exercise-panel">
                        <div class="panel-header">
                            <h3>Ajouter une √©tape</h3>
                        </div>
                        <div class="add-exercise-form">
                            <div class="form-group">
                                <label>Banque de questions <span class="req">*</span></label>
                                <select class="form-select" id="connBanque">
                                    <option value="">S√©lectionner une banque...</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Type de questions</label>
                                <select class="form-select" id="connQuestionType">
                                    <option value="qcm">QCM (choix unique)</option>
                                    <option value="vrai_faux">Vrai / Faux</option>
                                    <option value="chronologie">Chronologie (dates ‚Üî √©v√©nements)</option>
                                    <option value="timeline">Timeline (ordonner)</option>
                                    <option value="association">Association (paires)</option>
                                    <option value="texte_trou">Texte √† trous</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Questions disponibles</label>
                                <div class="conn-questions-info" id="connQuestionsInfo">
                                    <span class="conn-available">0 questions disponibles</span>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Nombre de questions</label>
                                <input type="number" class="form-input" id="connQuestionCount" value="5" min="1" max="20">
                            </div>

                            <div class="form-group">
                                <label>Mode de s√©lection</label>
                                <div class="radio-group">
                                    <label class="radio-item">
                                        <input type="radio" name="connSelectionMode" value="random" checked>
                                        <span>Al√©atoire</span>
                                    </label>
                                    <label class="radio-item">
                                        <input type="radio" name="connSelectionMode" value="manual">
                                        <span>S√©lection manuelle</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Questions disponibles pour s√©lection manuelle -->
                            <div class="elements-available" id="connQuestionsAvailable" style="display: none;">
                                <label>Questions √† s√©lectionner</label>
                                <div class="elements-checkboxes" id="connQuestionsCheckboxes">
                                    <!-- Generated -->
                                </div>
                            </div>

                            <button class="btn btn-primary btn-full" id="addEtapeBtn">
                                + Ajouter l'√©tape
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 3: Validation -->
            <div class="wizard-content" id="step3" style="display: none;">
                <div class="validation-recap">
                    <h3>Recapitulatif</h3>

                    <div class="recap-section">
                        <h4>Informations generales</h4>
                        <div class="recap-grid">
                            <div class="recap-item">
                                <span class="recap-label">Titre</span>
                                <span class="recap-value" id="recapTitre">-</span>
                            </div>
                            <div class="recap-item">
                                <span class="recap-label">Type</span>
                                <span class="recap-value" id="recapType">-</span>
                            </div>
                            <div class="recap-item">
                                <span class="recap-label">Chapitre</span>
                                <span class="recap-value" id="recapChapitre">-</span>
                            </div>
                            <div class="recap-item">
                                <span class="recap-label">Duree</span>
                                <span class="recap-value" id="recapDuree">-</span>
                            </div>
                            <div class="recap-item">
                                <span class="recap-label">Statut</span>
                                <span class="recap-value" id="recapStatut">-</span>
                            </div>
                        </div>
                    </div>

                    <div class="recap-section">
                        <h4>Composition</h4>
                        <div class="recap-exercises" id="recapExercises">
                            <!-- Generated -->
                        </div>
                    </div>

                    <button class="btn btn-secondary" id="previewBtn">
                        Apercu de l'entrainement
                    </button>
                </div>
            </div>
        </div>

        <div class="modal-footer">
            <div class="footer-left">
                <button class="btn btn-secondary" id="saveDraftBtn">Enregistrer en brouillon</button>
            </div>
            <div class="footer-right">
                <button class="btn btn-secondary" id="prevStepBtn" style="display: none;">Precedent</button>
                <button class="btn btn-primary" id="nextStepBtn">Suivant</button>
                <button class="btn btn-primary" id="publishBtn" style="display: none;">Publier</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Confirmation suppression -->
<div class="modal-overlay hidden" id="deleteModal">
    <div class="modal modal-small">
        <div class="modal-header">
            <h2>Confirmer la suppression</h2>
            <button class="modal-close" id="closeDeleteModal">&times;</button>
        </div>
        <div class="modal-body">
            <p>Etes-vous sur de vouloir supprimer cet entrainement ?</p>
            <p class="delete-warning">Cette action est irreversible.</p>
            <input type="hidden" id="deleteEntrainementId">
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" id="cancelDeleteBtn">Annuler</button>
            <button class="btn btn-danger" id="confirmDeleteBtn">Supprimer</button>
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="../js/config.js"></script>
<script src="../js/sheets.js"></script>
<script src="../js/auth.js"></script>
<script src="../js/app.js"></script>
<script src="../components/admin-layout.js"></script>
<script src="../js/admin-entrainements.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        AdminLayout.init('entrainements', 'Entrainements');
    });
</script>

</body>
</html>
